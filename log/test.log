  [1m[35m (11.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "ar_internal_metadata"."value" FROM "ar_internal_metadata" WHERE "ar_internal_metadata"."key" = ?[0m  [["key", "schema_sha1"]]
  [1m[35m (0.2ms)[0m  [1m[34mSELECT sqlite_version(*)[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT "schema_migrations"."version" FROM "schema_migrations" ORDER BY "schema_migrations"."version" ASC[0m
  [1m[35m (0.5ms)[0m  [1m[35mPRAGMA foreign_keys[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA defer_foreign_keys = ON[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = OFF[0m
  [1m[35m (514.8ms)[0m  [1m[31mDELETE FROM "publishers";[0m
  [1m[35m (2.6ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (196.1ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'publishers';[0m
  [1m[35m (158.5ms)[0m  [1m[31mDELETE FROM "books";[0m
  [1m[35m (3.4ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (129.2ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'books';[0m
  [1m[35m (116.1ms)[0m  [1m[31mDELETE FROM "shops";[0m
  [1m[35m (1.1ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (105.2ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'shops';[0m
  [1m[35m (223.9ms)[0m  [1m[31mDELETE FROM "purchases";[0m
  [1m[35m (0.8ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (157.7ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'purchases';[0m
  [1m[35m (142.8ms)[0m  [1m[31mDELETE FROM "stocks";[0m
  [1m[35m (1.3ms)[0m  [1m[34mSELECT name FROM sqlite_master WHERE type='table' AND name='sqlite_sequence';[0m
  [1m[35m (153.4ms)[0m  [1m[31mDELETE FROM sqlite_sequence where name = 'stocks';[0m
  [1m[35m (0.2ms)[0m  [1m[35mPRAGMA defer_foreign_keys = 0[0m
  [1m[35m (0.1ms)[0m  [1m[35mPRAGMA foreign_keys = 1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (2.8ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Zondervan"], ["created_at", "2020-12-13 16:14:23.547178"], ["updated_at", "2020-12-13 16:14:23.547178"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (0.3ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Vintage Books"], ["created_at", "2020-12-13 16:14:23.555214"], ["updated_at", "2020-12-13 16:14:23.555214"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.6ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 1"], ["publisher_id", 1], ["created_at", "2020-12-13 16:14:23.559805"], ["updated_at", "2020-12-13 16:14:23.559805"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.4ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 2"], ["publisher_id", 1], ["created_at", "2020-12-13 16:14:23.565208"], ["updated_at", "2020-12-13 16:14:23.565208"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.4ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 3"], ["publisher_id", 2], ["created_at", "2020-12-13 16:14:23.569714"], ["updated_at", "2020-12-13 16:14:23.569714"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 1"], ["created_at", "2020-12-13 16:14:23.574771"], ["updated_at", "2020-12-13 16:14:23.574771"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 2"], ["created_at", "2020-12-13 16:14:23.578643"], ["updated_at", "2020-12-13 16:14:23.578643"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 3"], ["created_at", "2020-12-13 16:14:23.583295"], ["updated_at", "2020-12-13 16:14:23.583295"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.6ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 1], ["amount", 7], ["created_at", "2020-12-13 16:14:23.588702"], ["updated_at", "2020-12-13 16:14:23.588702"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (2.5ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 2], ["amount", 5], ["created_at", "2020-12-13 16:14:23.593744"], ["updated_at", "2020-12-13 16:14:23.593744"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (1.0ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 3], ["amount", 11], ["created_at", "2020-12-13 16:14:23.600727"], ["updated_at", "2020-12-13 16:14:23.600727"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.6ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 1], ["amount", 0], ["created_at", "2020-12-13 16:14:23.606182"], ["updated_at", "2020-12-13 16:14:23.606182"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.5ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["amount", 3], ["created_at", "2020-12-13 16:14:23.610942"], ["updated_at", "2020-12-13 16:14:23.610942"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (1.0ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["amount", 19], ["created_at", "2020-12-13 16:14:23.615936"], ["updated_at", "2020-12-13 16:14:23.615936"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.5ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 3], ["book_id", 3], ["amount", 55], ["created_at", "2020-12-13 16:14:23.621281"], ["updated_at", "2020-12-13 16:14:23.621281"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.9ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.626246"], ["updated_at", "2020-12-13 16:14:23.626246"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.631857"], ["updated_at", "2020-12-13 16:14:23.631857"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.636586"], ["updated_at", "2020-12-13 16:14:23.636586"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.8ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.641578"], ["updated_at", "2020-12-13 16:14:23.641578"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.646715"], ["updated_at", "2020-12-13 16:14:23.646715"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.5ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.652060"], ["updated_at", "2020-12-13 16:14:23.652060"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.7ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["created_at", "2020-12-13 16:14:23.656805"], ["updated_at", "2020-12-13 16:14:23.656805"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.7ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.662301"], ["updated_at", "2020-12-13 16:14:23.662301"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.668162"], ["updated_at", "2020-12-13 16:14:23.668162"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.672928"], ["updated_at", "2020-12-13 16:14:23.672928"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.7ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.677636"], ["updated_at", "2020-12-13 16:14:23.677636"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.9ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.682572"], ["updated_at", "2020-12-13 16:14:23.682572"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (1.2ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.687824"], ["updated_at", "2020-12-13 16:14:23.687824"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.9ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.693091"], ["updated_at", "2020-12-13 16:14:23.693091"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.7ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.698440"], ["updated_at", "2020-12-13 16:14:23.698440"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.5ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.703648"], ["updated_at", "2020-12-13 16:14:23.703648"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.5ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.708448"], ["updated_at", "2020-12-13 16:14:23.708448"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.713018"], ["updated_at", "2020-12-13 16:14:23.713018"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.7ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 3], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.718698"], ["updated_at", "2020-12-13 16:14:23.718698"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPurchase Create (0.6ms)[0m  [1m[32mINSERT INTO "purchases" ("shop_id", "book_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["shop_id", 3], ["book_id", 3], ["created_at", "2020-12-13 16:14:23.723518"], ["updated_at", "2020-12-13 16:14:23.723518"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
Started GET "/publishers/1/shops" for 127.0.0.1 at 2020-12-13 19:14:23 +0300
Processing by PublisherController#shops as HTML
  Parameters: {"id"=>"1"}
  [1m[36mPublisher Load (0.4ms)[0m  [1m[34mSELECT "publishers".* FROM "publishers" WHERE "publishers"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mShop Load (1.4ms)[0m  [1m[34mSELECT sh.*,
 p.sold_count
FROM shops sh
  INNER JOIN (
    SELECT DISTINCT s.shop_id
    FROM stocks s
      INNER JOIN books b ON b.id = s.book_id
    WHERE b.publisher_id = 1
      AND s.amount > 0
             ) st ON st.shop_id = sh.id
  LEFT JOIN (
    SELECT p.shop_id,
           count(*) AS sold_count
    FROM purchases p
      INNER JOIN books b ON b.id = p.book_id
    WHERE b.publisher_id = 1
    GROUP BY p.shop_id
            ) p ON p.shop_id = sh.id
ORDER BY p.sold_count
[0m
[active_model_serializers]   [1m[36mBook Load (0.5ms)[0m  [1m[34mSELECT books.*, stocks.amount, stocks.shop_id FROM "books" INNER JOIN "stocks" ON "stocks"."book_id" = "books"."id" WHERE "books"."publisher_id" = ?[0m  [["publisher_id", 1]]
[active_model_serializers] Rendered PublisherShopsSerializer with ActiveModelSerializers::Adapter::Attributes (65.05ms)
Completed 200 OK in 250ms (Views: 110.2ms | ActiveRecord: 2.2ms | Allocations: 14374)
  [1m[36mTRANSACTION (2.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (28.6ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started GET "/publishers/unknown/shops" for 127.0.0.1 at 2020-12-13 19:14:24 +0300
Processing by PublisherController#shops as HTML
  Parameters: {"id"=>"unknown"}
  [1m[36mPublisher Load (0.6ms)[0m  [1m[34mSELECT "publishers".* FROM "publishers" WHERE "publishers"."id" = ? LIMIT ?[0m  [["id", nil], ["LIMIT", 1]]
[active_model_serializers] Rendered ActiveModel::Serializer::Null with Hash (0.17ms)
Completed 404 Not Found in 32ms (Views: 30.1ms | ActiveRecord: 0.6ms | Allocations: 2153)
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (2.6ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Mandrake of Oxford"], ["created_at", "2020-12-13 16:14:24.158301"], ["updated_at", "2020-12-13 16:14:24.158301"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.8ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 1"], ["publisher_id", 1], ["created_at", "2020-12-13 16:14:24.164869"], ["updated_at", "2020-12-13 16:14:24.164869"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (0.3ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Lion Hudson"], ["created_at", "2020-12-13 16:14:24.170622"], ["updated_at", "2020-12-13 16:14:24.170622"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.7ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 2"], ["publisher_id", 2], ["created_at", "2020-12-13 16:14:24.174533"], ["updated_at", "2020-12-13 16:14:24.174533"]]
  [1m[36mTRANSACTION (0.6ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (0.4ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Ziff Davis Media"], ["created_at", "2020-12-13 16:14:24.188707"], ["updated_at", "2020-12-13 16:14:24.188707"]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.4ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 3"], ["publisher_id", 3], ["created_at", "2020-12-13 16:14:24.202872"], ["updated_at", "2020-12-13 16:14:24.202872"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 1"], ["created_at", "2020-12-13 16:14:24.207702"], ["updated_at", "2020-12-13 16:14:24.207702"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.3ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 2"], ["created_at", "2020-12-13 16:14:24.211984"], ["updated_at", "2020-12-13 16:14:24.211984"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.7ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 1], ["amount", 7], ["created_at", "2020-12-13 16:14:24.216944"], ["updated_at", "2020-12-13 16:14:24.216944"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (2.1ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 2], ["amount", 5], ["created_at", "2020-12-13 16:14:24.222894"], ["updated_at", "2020-12-13 16:14:24.222894"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.5ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 3], ["amount", 11], ["created_at", "2020-12-13 16:14:24.229269"], ["updated_at", "2020-12-13 16:14:24.229269"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.8ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 1], ["amount", 0], ["created_at", "2020-12-13 16:14:24.234236"], ["updated_at", "2020-12-13 16:14:24.234236"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.5ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 2], ["amount", 3], ["created_at", "2020-12-13 16:14:24.239071"], ["updated_at", "2020-12-13 16:14:24.239071"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.4ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 2], ["book_id", 3], ["amount", 19], ["created_at", "2020-12-13 16:14:24.243612"], ["updated_at", "2020-12-13 16:14:24.243612"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
Started POST "/shops/1/sold_out" for 127.0.0.1 at 2020-12-13 19:14:24 +0300
Processing by ShopController#sold_out as HTML
  Parameters: {"ids"=>["1", "3"], "id"=>"1"}
  [1m[36mShop Load (0.4ms)[0m  [1m[34mSELECT "shops".* FROM "shops" WHERE "shops"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStock Update All (0.4ms)[0m  [1m[33mUPDATE "stocks" SET "amount" = ? WHERE "stocks"."shop_id" = ? AND "stocks"."book_id" IN (?, ?) AND (amount > 0)[0m  [["amount", 0], ["shop_id", 1], [nil, 1], [nil, 3]]
[active_model_serializers] Rendered ActiveModel::Serializer::Null with Hash (0.13ms)
Completed 200 OK in 45ms (Views: 1.3ms | ActiveRecord: 0.9ms | Allocations: 2887)
  [1m[36mStock Load (0.4ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStock Load (0.1ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 2], ["LIMIT", 1]]
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 3], ["LIMIT", 1]]
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 4], ["LIMIT", 1]]
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 5], ["LIMIT", 1]]
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 6], ["LIMIT", 1]]
  [1m[36mTRANSACTION (1.0ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (15.1ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
Started POST "/shops/unknown/sold_out" for 127.0.0.1 at 2020-12-13 19:14:24 +0300
Processing by ShopController#sold_out as HTML
  Parameters: {"ids"=>[""], "id"=>"unknown"}
  [1m[36mShop Load (0.6ms)[0m  [1m[34mSELECT "shops".* FROM "shops" WHERE "shops"."id" = ? LIMIT ?[0m  [["id", nil], ["LIMIT", 1]]
[active_model_serializers] Rendered ActiveModel::Serializer::Null with Hash (0.16ms)
Completed 404 Not Found in 3ms (Views: 1.2ms | ActiveRecord: 0.6ms | Allocations: 272)
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (4.6ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Churchill Livingstone"], ["created_at", "2020-12-13 16:14:24.375048"], ["updated_at", "2020-12-13 16:14:24.375048"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.7ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 1"], ["publisher_id", 1], ["created_at", "2020-12-13 16:14:24.384815"], ["updated_at", "2020-12-13 16:14:24.384815"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.4ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 1"], ["created_at", "2020-12-13 16:14:24.390099"], ["updated_at", "2020-12-13 16:14:24.390099"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.6ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 1], ["amount", 4], ["created_at", "2020-12-13 16:14:24.394983"], ["updated_at", "2020-12-13 16:14:24.394983"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
Started POST "/shops/1/sold_out" for 127.0.0.1 at 2020-12-13 19:14:24 +0300
Processing by ShopController#sold_out as HTML
  Parameters: {"ids"=>["invalid"], "id"=>"1"}
  [1m[36mShop Load (0.2ms)[0m  [1m[34mSELECT "shops".* FROM "shops" WHERE "shops"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStock Update All (0.3ms)[0m  [1m[33mUPDATE "stocks" SET "amount" = ? WHERE "stocks"."shop_id" = ? AND "stocks"."book_id" = ? AND (amount > 0)[0m  [["amount", 0], ["shop_id", 1], ["book_id", nil]]
[active_model_serializers] Rendered ActiveModel::Serializer::Null with Hash (0.2ms)
Completed 200 OK in 5ms (Views: 1.2ms | ActiveRecord: 0.5ms | Allocations: 580)
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.4ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (18.9ms)[0m  [1m[31mrollback transaction[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[36mbegin transaction[0m
  [1m[36mTRANSACTION (0.3ms)[0m  [1m[35mSAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (0.7ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mPublisher Create (3.0ms)[0m  [1m[32mINSERT INTO "publishers" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Zondervan"], ["created_at", "2020-12-13 16:14:24.438598"], ["updated_at", "2020-12-13 16:14:24.438598"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mBook Create (0.7ms)[0m  [1m[32mINSERT INTO "books" ("title", "publisher_id", "created_at", "updated_at") VALUES (?, ?, ?, ?)[0m  [["title", "Book 1"], ["publisher_id", 1], ["created_at", "2020-12-13 16:14:24.446234"], ["updated_at", "2020-12-13 16:14:24.446234"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mShop Create (0.7ms)[0m  [1m[32mINSERT INTO "shops" ("name", "created_at", "updated_at") VALUES (?, ?, ?)[0m  [["name", "Shop 1"], ["created_at", "2020-12-13 16:14:24.451817"], ["updated_at", "2020-12-13 16:14:24.451817"]]
  [1m[36mTRANSACTION (0.1ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mSAVEPOINT active_record_2[0m
  [1m[36mStock Create (0.6ms)[0m  [1m[32mINSERT INTO "stocks" ("shop_id", "book_id", "amount", "created_at", "updated_at") VALUES (?, ?, ?, ?, ?)[0m  [["shop_id", 1], ["book_id", 1], ["amount", 4], ["created_at", "2020-12-13 16:14:24.457189"], ["updated_at", "2020-12-13 16:14:24.457189"]]
  [1m[36mTRANSACTION (0.2ms)[0m  [1m[35mRELEASE SAVEPOINT active_record_2[0m
Started POST "/shops/1/sold_out" for 127.0.0.1 at 2020-12-13 19:14:24 +0300
Processing by ShopController#sold_out as HTML
  Parameters: {"ids"=>[""], "id"=>"1"}
  [1m[36mShop Load (0.1ms)[0m  [1m[34mSELECT "shops".* FROM "shops" WHERE "shops"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mStock Update All (0.6ms)[0m  [1m[33mUPDATE "stocks" SET "amount" = ? WHERE "stocks"."shop_id" = ? AND "stocks"."book_id" = ? AND (amount > 0)[0m  [["amount", 0], ["shop_id", 1], ["book_id", nil]]
[active_model_serializers] Rendered ActiveModel::Serializer::Null with Hash (0.23ms)
Completed 200 OK in 8ms (Views: 3.0ms | ActiveRecord: 0.8ms | Allocations: 580)
  [1m[36mStock Load (0.2ms)[0m  [1m[34mSELECT "stocks".* FROM "stocks" WHERE "stocks"."id" = ? LIMIT ?[0m  [["id", 1], ["LIMIT", 1]]
  [1m[36mTRANSACTION (0.5ms)[0m  [1m[31mROLLBACK TO SAVEPOINT active_record_1[0m
  [1m[36mTRANSACTION (17.3ms)[0m  [1m[31mrollback transaction[0m
